- 直接用supabase 的vi editor 編輯。

### Note
- GET → 前端直接抓 Storage JSON
- POST → 抓最新股價 → 批次插入 Supabase table → 上傳 JSON
- 批次插入 → 避免單次 insert 過大導致 API 超時或限制
- truncate RPC → 先清空舊資料，保持表只存最新資料
- Storage JSON → 前端快速取得最新股價列表
- 自動處理民國純數字日期"1041023" → 西元(2025-10-23)
- 過濾股價 < 10 & 空股號

### Detail
Function Name
update_stock_prices

Slug
update_stock_prices

Endpoint URL
https://btzjjozytwtbgdznralj.supabase.co/functions/v1/update_stock_prices

### SQL Schema + Policy (Supabase SQL EDITOR)
```
-- 建立資料表
create table if not exists stock_prices (
  id bigint generated by default as identity primary key,
  stock_code text not null,
  stock_name text,
  price numeric,
  market text,
  date date not null,
  inserted_at timestamptz default now(),
  constraint uniq_stock_date unique (stock_code, date)
);

-- 建立快速清空用的 function
create or replace function truncate_stock_prices()
returns void as $$
begin
  truncate table stock_prices restart identity;
end;
$$ language plpgsql security definer;

-- 設定存取權限
alter table public.stock_prices enable row level security;

revoke all on public.stock_prices from anon;
revoke all on public.stock_prices from authenticated;
grant all on public.stock_prices to service_role;

drop policy if exists "Allow read for public" on public.stock_prices;
drop policy if exists "Allow service role full access" on public.stock_prices;

create policy "Allow read for public"
on public.stock_prices
for select
using (true);

create policy "Allow service role full access"
on public.stock_prices
for all
to service_role
using (true)
with check (true);


```